<!-- (c) Copyright 2025 by Muczynski -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“š</text></svg>">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
        <a class="navbar-brand" href="#" id="page-title">Library Management</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0" id="section-menu" style="display: none;" data-test="section-menu">
                <li class="nav-item librarian-only">
                    <button class="nav-link" onclick="showSection('libraries', event)" data-test="menu-libraries">Libraries</button>
                </li>
                <li class="nav-item librarian-only">
                    <button class="nav-link" onclick="showSection('authors', event)" data-test="menu-authors">Authors</button>
                </li>
                <li class="nav-item public-item">
                    <button class="nav-link" onclick="showSection('books', event)" data-test="menu-books">Books</button>
                </li>
                <li class="nav-item librarian-only">
                    <button class="nav-link" onclick="createBookByPhoto()" data-test="menu-book-by-photo">Book-by-Photo</button>
                </li>
                <li class="nav-item public-item">
                    <button class="nav-link" onclick="showSection('search', event)" data-test="menu-search">Search</button>
                </li>
                <li class="nav-item public-item" data-test="menu-library-card-item">
                    <button class="nav-link" onclick="showSection('library-card', event)" data-test="menu-library-card">Library Card</button>
                </li>
                <li class="nav-item librarian-only">
                    <button class="nav-link" onclick="showSection('users', event)" data-test="menu-users">Users</button>
                </li>
                <li class="nav-item librarian-only">
                    <button class="nav-link" onclick="showSection('loans', event)" data-test="menu-loans">Loans</button>
                </li>
                <li class="nav-item public-item" data-test="menu-test-data-item">
                    <button class="nav-link" onclick="showSection('test-data', event)" data-test="menu-test-data">Test Data</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" onclick="showSection('settings', event)" data-test="menu-settings">Settings</button>
                </li>
            </ul>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <button class="nav-link" id="login-menu-btn" onclick="showLoginForm()" data-test="menu-login">Login</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" id="logout-menu-btn" onclick="logout()" data-test="menu-logout" style="display: none;">Logout</button>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <div id="login-form" data-test="login-form" class="col-md-6 offset-md-3" style="display: none;">
        <h2 data-test="login-header">Login</h2>
        <form id="login" name="login" action="/login" method="post">
            <div class="mb-3">
                <label for="username" class="form-label">Name:</label>
                <input type="text" id="username" name="username" class="form-control" autocomplete="username" required data-test="login-username">
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Password:</label>
                <input type="password" id="password" name="password" class="form-control" autocomplete="current-password" required data-test="login-password">
            </div>
            <button type="submit" name="login-submit" class="btn btn-primary" data-test="login-submit" )">Login</button>
        </form>
        <div id="login-error" class="alert alert-danger mt-3" style="display: none;" data-test="login-error"></div>
    </div>

    <div id="main-content" style="display: none;" data-test="main-content">
    <div class="container" data-test="container">
        <div id="libraries-section" class="section" data-test="libraries-section">
            <h2 data-test="libraries-header">Libraries</h2>
            <ul id="library-list" class="list-group mb-3" data-test="library-list"></ul>
            <div class="librarian-only" data-test="libraries-form">
                <div class="input-group mb-3">
                    <input type="text" id="new-library-name" class="form-control" placeholder="New library name" data-test="new-library-name">
                    <input type="text" id="new-library-hostname" class="form-control" placeholder="Hostname" data-test="new-library-hostname">
                    <button id="add-library-btn" class="btn btn-primary" onclick="addLibrary()" data-test="add-library-btn">Add Library</button>
                </div>
            </div>
        </div>

        <div id="authors-section" class="section" data-test="authors-section">
            <h2 data-test="authors-header">Authors</h2>
            <table class="table" data-test="author-table">
                <thead>
                <tr>
                    <th scope="col">Photo</th>
                    <th scope="col">Author</th>
                    <th scope="col">Actions</th>
                </tr>
                </thead>
                <tbody id="author-list-body" data-test="author-list-body">
                </tbody>
            </table>
            <div class="librarian-only" data-test="authors-form">
                <div class="mb-3">
                    <label for="new-author-name" class="form-label">Author Name:</label>
                    <input type="text" id="new-author-name" class="form-control" placeholder="New author name" autocomplete="off" data-test="new-author-name">
                </div>
                <div class="mb-3">
                    <label for="new-author-dob" class="form-label">Date of Birth:</label>
                    <input type="date" id="new-author-dob" class="form-control" autocomplete="off" data-test="new-author-dob">
                </div>
                <div class="mb-3">
                    <label for="new-author-dod" class="form-label">Date of Death:</label>
                    <input type="date" id="new-author-dod" class="form-control" autocomplete="off" data-test="new-author-dod">
                </div>
                <div class="mb-3">
                    <label for="new-author-religion" class="form-label">Religious Affiliation:</label>
                    <input type="text" id="new-author-religion" class="form-control" placeholder="Religious Affiliation" autocomplete="off" data-test="new-author-religion">
                </div>
                <div class="mb-3">
                    <label for="new-author-country" class="form-label">Birth Country:</label>
                    <input type="text" id="new-author-country" class="form-control" placeholder="Birth Country" autocomplete="off" data-test="new-author-country">
                </div>
                <div class="mb-3">
                    <label for="new-author-nationality" class="form-label">Nationality:</label>
                    <input type="text" id="new-author-nationality" class="form-control" placeholder="Nationality" autocomplete="off" data-test="new-author-nationality">
                </div>
                <div class="mb-3">
                    <label for="new-author-bio" class="form-label">Brief Biography:</label>
                    <textarea id="new-author-bio" class="form-control" placeholder="Brief Biography" autocomplete="off" data-test="new-author-bio"></textarea>
                </div>
                <button id="add-author-btn" class="btn btn-primary mb-3" onclick="addAuthor()" data-test="add-author-btn">Add Author</button>
                <button id="cancel-author-btn" class="btn btn-secondary mb-3" onclick="resetAuthorForm()" data-test="cancel-author-btn" style="display: none;">Cancel</button>
                <button id="add-author-photo-btn" class="btn btn-secondary mb-3" onclick="addAuthorPhoto()" data-test="add-author-photo-btn" style="display: none;">Add Photo</button>
                <input type="hidden" id="current-author-id">
                <input type="file" id="author-photo-upload" style="display: none;" accept="image/*" capture="environment"/>
                <div id="author-photos-container" class="mb-3" style="display: none;" data-test="author-photos-container">
                    <h3 data-test="author-photos-header">Author Photos</h3>
                    <div id="author-photos" data-test="author-photos"></div>
                </div>
            </div>
        </div>

        <div id="books-section" class="section" data-test="books-section">
            <h2 data-test="books-header">Books</h2>
            <table class="table" data-test="book-table">
                <thead>
                <tr>
                    <th scope="col">Photo</th>
                    <th scope="col">Book</th>
                    <th scope="col">Loans</th>
                    <th scope="col">Actions</th>
                </tr>
                </thead>
                <tbody id="book-list-body" data-test="book-list-body">
                </tbody>
            </table>
            <div class="librarian-only" data-test="books-form">
                <div class="mb-3">
                    <label for="new-book-title" class="form-label">Book Title:</label>
                    <input type="text" id="new-book-title" class="form-control" placeholder="New book title" autocomplete="off" data-test="new-book-title">
                </div>
                <div class="mb-3">
                    <label for="new-book-year" class="form-label">Publication Year:</label>
                    <input type="number" id="new-book-year" class="form-control" placeholder="Publication Year" autocomplete="off" data-test="new-book-year">
                </div>
                <div class="mb-3">
                    <label for="new-book-publisher" class="form-label">Publisher:</label>
                    <input type="text" id="new-book-publisher" class="form-control" placeholder="Publisher" autocomplete="off" data-test="new-book-publisher">
                </div>
                <div class="mb-3">
                    <label for="new-book-summary" class="form-label">Plot Summary:</label>
                    <textarea id="new-book-summary" class="form-control" placeholder="Plot Summary" autocomplete="off" data-test="new-book-summary"></textarea>
                </div>
                <div class="mb-3">
                    <label for="new-book-related" class="form-label">Related Works:</label>
                    <input type="text" id="new-book-related" class="form-control" placeholder="Related Works" autocomplete="off" data-test="new-book-related">
                </div>
                <div class="mb-3">
                    <label for="new-book-description" class="form-label">Detailed Description:</label>
                    <textarea id="new-book-description" class="form-control" placeholder="Detailed Description" autocomplete="off" data-test="new-book-description"></textarea>
                </div>
                <div class="mb-3">
                    <label for="new-book-added" class="form-label">Date Added to Library:</label>
                    <input type="date" id="new-book-added" class="form-control" autocomplete="off" data-test="new-book-added">
                </div>
                <div class="mb-3">
                    <label for="new-book-status" class="form-label">Status:</label>
                    <select id="new-book-status" class="form-select" data-test="new-book-status">
                        <option value="ACTIVE">Active</option>
                        <option value="LOST">Lost</option>
                        <option value="WITHDRAWN">Withdrawn</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="book-author" class="form-label">Author:</label>
                    <select id="book-author" class="form-select" data-test="book-author"></select>
                </div>
                <div class="mb-3">
                    <label for="book-library" class="form-label">Library:</label>
                    <select id="book-library" class="form-select" data-test="book-library"></select>
                </div>
                <input type="hidden" id="current-book-id">
                <button id="add-book-btn" class="btn btn-primary mb-3" onclick="addBook()" data-test="add-book-btn">Add Book</button>
                <button id="cancel-book-btn" class="btn btn-secondary mb-3" onclick="resetBookForm()" data-test="cancel-book-btn" style="display: none;">Cancel</button>
                <button id="add-photo-btn" class="btn btn-secondary mb-3" onclick="addPhoto()" data-test="add-photo-btn" style="display: none;">Add Photo</button>
                <button id="book-by-photo-btn" class="btn btn-secondary mb-3" onclick="createBookByPhoto()" data-test="book-by-photo-btn" style="display: none;">Book-by-Photo</button>
                <input type="file" id="photo-upload" style="display: none;" accept="image/*" capture="environment"/>
                <div id="book-photos-container" class="mb-3" style="display: none;" data-test="book-photos-container">
                    <h3 data-test="book-photos-header">Book Photos</h3>
                    <div id="book-photos" data-test="book-photos"></div>
                </div>
            </div>
        </div>

        <div id="search-section" class="section" data-test="search-section">
            <h2 data-test="search-header">Search</h2>
            <div class="input-group mb-3" data-test="search-form">
                <input type="text" id="search-input" class="form-control" placeholder="Search books and authors..." autocomplete="off" data-test="search-input">
                <button class="btn btn-primary" onclick="performSearch()" data-test="search-btn">Search</button>
            </div>
            <div id="search-results" data-test="search-results"></div>
        </div>

        <div id="library-card-section" class="section" data-test="library-card-section">
            <div id="apply-for-card-section" data-test="apply-for-card-section">
                <h2 data-test="apply-for-card-header">Apply for a Library Card</h2>
                <form data-test="apply-for-card-form">
                    <div class="mb-3">
                        <label for="new-applicant-name" class="form-label">Name:</label>
                        <input type="text" id="new-applicant-name" class="form-control" placeholder="Your Name" autocomplete="off" data-test="new-applicant-name">
                    </div>
                    <div class="mb-3">
                        <label for="new-applicant-password" class="form-label">Password:</label>
                        <input type="password" id="new-applicant-password" class="form-control" placeholder="Password" autocomplete="new-password" data-test="new-applicant-password">
                    </div>
                    <button id="apply-for-card-btn" type="button" class="btn btn-primary" onclick="applyForCard()" data-test="apply-for-card-btn">Apply</button>
                </form>
                <div id="apply-error" class="alert alert-danger mt-3" style="display: none;" data-test="apply-error"></div>
                <div id="apply-success" class="alert alert-success mt-3" style="display: none;" data-test="apply-success"></div>
            </div>

            <div id="applied-section" class="librarian-only mt-5" data-test="applied-section">
                <h2 data-test="applied-header">Applications</h2>
                <table class="table" data-test="applied-table">
                    <thead>
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col">Status</th>
                        <th scope="col">Actions</th>
                    </tr>
                    </thead>
                    <tbody id="applied-list-body" data-test="applied-list-body">
                    </tbody>
                </table>
            </div>
        </div>

        <div id="users-section" class="section librarian-only" data-test="users-section">
            <h2 data-test="users-header">Users</h2>
            <table class="table" data-test="user-table">
                <thead>
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col">Books on Loan</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody id="user-list-body" data-test="user-list-body">
                </tbody>
            </table>
            <form data-test="users-form">
                <div class="mb-3">
                    <label for="new-user-username" class="form-label">Name:</label>
                    <input type="text" id="new-user-username" class="form-control" placeholder="Name" autocomplete="off" data-test="new-user-username">
                </div>
                <div class="mb-3">
                    <label for="new-user-password" class="form-label">Password:</label>
                    <input type="password" id="new-user-password" class="form-control" placeholder="Password" autocomplete="new-password" data-test="new-user-password">
                </div>
                <div class="mb-3">
                    <label for="new-user-role" class="form-label">Role:</label>
                    <select id="new-user-role" class="form-select" data-test="new-user-role">
                        <option value="LIBRARIAN">Librarian</option>
                        <option value="USER">User</option>
                    </select>
                </div>
                <button id="add-user-btn" type="button" class="btn btn-primary" onclick="addUser()" data-test="add-user-btn">Add User</button>
            </form>
        </div>

        <div id="loans-section" class="section librarian-only" data-test="loans-section">
            <h2 data-test="loans-header">Loans</h2>
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" value="" id="show-returned-loans" onchange="loadLoans()" data-test="show-returned-loans-checkbox">
                <label class="form-check-label" for="show-returned-loans">
                    Show returned loans
                </label>
            </div>
            <table class="table" data-test="loan-table">
                <thead>
                    <tr>
                        <th scope="col">Book Title</th>
                        <th scope="col">Name</th>
                        <th scope="col">Loan Date</th>
                        <th scope="col">Due Date</th>
                        <th scope="col">Return Date</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody id="loan-list-body" data-test="loan-list-body">
                </tbody>
            </table>
            <div data-test="loans-form">
                <div class="mb-3">
                    <label for="loan-book" class="form-label">Book:</label>
                    <select id="loan-book" class="form-select" data-test="loan-book"></select>
                </div>
                <div class="mb-3">
                    <label for="loan-user" class="form-label">Name:</label>
                    <select id="loan-user" class="form-select" data-test="loan-user"></select>
                </div>
                <div class="mb-3">
                    <label for="loan-date" class="form-label">Loan Date:</label>
                    <input type="date" id="loan-date" class="form-control" data-test="loan-date">
                </div>
                <div class="mb-3">
                    <label for="due-date" class="form-label">Due Date:</label>
                    <input type="date" id="due-date" class="form-control" data-test="due-date">
                </div>
                <div class="mb-3">
                    <label for="return-date" class="form-label">Return Date:</label>
                    <input type="date" id="return-date" class="form-control" data-test="return-date">
                </div>
                <button id="checkout-btn" class="btn btn-primary" onclick="checkoutBook()" data-test="checkout-btn">Checkout Book</button>
            </div>
        </div>

        <div id="test-data-section" class="section" data-test="test-data-section">
            <h2 data-test="test-data-header">Generate Test Data</h2>
            <div id="test-data-stats" class="mb-3" data-test="test-data-stats"></div>
            <div class="mb-3">
                <label for="num-books" class="form-label">Number of Items to Add:</label>
                <input type="number" id="num-books" class="form-control" placeholder="Number of items" data-test="num-books">
            </div>
            <button id="generate-test-data-btn" class="btn btn-primary" onclick="generateTestData()" data-test="generate-test-data-btn">Add Random Books</button>
            <button id="generate-test-loans-btn" class="btn btn-success" onclick="generateTestLoans()" data-test="generate-test-loans-btn">Add-Random-Loans</button>
            <button id="delete-all-test-data-btn" class="btn btn-danger" onclick="deleteAllTestData()" data-test="delete-all-test-data-btn">Delete All Test Data</button>
            <button id="total-purge-btn" class="btn btn-dark" onclick="totalPurge()" data-test="total-purge-btn">Total Purge</button>
        </div>

        <div id="settings-section" class="section" data-test="settings-section">
            <h2 data-test="settings-header">Settings</h2>
            <form id="settings-form" onsubmit="saveSettings(event)">
                <div class="mb-3">
                    <label for="user-name" class="form-label">Name</label>
                    <input type="text" id="user-name" class="form-control" autocomplete="name" data-test="user-name">
                </div>
                <div class="mb-3">
                    <label for="user-password" class="form-label">New Password</label>
                    <input type="password" id="user-password" class="form-control" autocomplete="new-password" data-test="user-password">
                    <div class="form-text">Leave blank to keep your current password.</div>
                </div>
                <div class="mb-3">
                    <label for="xai-api-key" class="form-label">XAI API Key (for AI features)</label>
                    <input type="text" id="xai-api-key" class="form-control" autocomplete="off" placeholder="Enter your xAI API key" data-test="xai-api-key">
                    <div class="form-text">This key enables AI-powered search and recommendations. Get one from x.ai.</div>
                </div>
                <button type="submit" class="btn btn-primary" data-test="save-settings-btn">Save Settings</button>
            </form>
            <div id="settings-error" class="alert alert-danger mt-3" style="display: none;" data-test="settings-error"></div>
            <div id="settings-success" class="alert alert-success mt-3" style="display: none;" data-test="settings-success"></div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
<script src="js/books.js"></script>
<script src="js/libraries.js"></script>
<script src="js/authors.js"></script>
<script src="js/users.js"></script>
<script src="js/loans.js"></script>
<script src="js/applied.js"></script>
<script src="js/apply-for-card.js"></script>
<script src="js/search.js"></script>
<script src="js/settings.js"></script>
<script src="js/test-data.js"></script>
<script src="js/app.js"></script>

</body>
</html>
