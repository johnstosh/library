# Server configuration
server.port=${PORT:8080}
# NOTE: Do NOT use server.forward-headers-strategy here - it causes OAuth redirect_uri errors.
# The external base URL is configured via app.external-base-url instead.

# External base URL for OAuth redirect URIs (required when behind a reverse proxy)
# This should be the public URL users access the application through
app.external-base-url=${APP_EXTERNAL_BASE_URL:https://library.muczynskifamily.com}

# Database configuration (PostgreSQL via Docker for local development)
# Start the database with: source ./docker-bootrun.sh && ./gradlew bootRun
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/library}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:postgres}

spring.jpa.open-in-view=false
spring.jpa.show-sql=false
spring.jpa.defer-datasource-initialization=true

# Database connection pool configuration
# Pool size must support concurrent operations (e.g., chunked photo import uses 2 connections)
spring.datasource.hikari.maximum-pool-size=30
spring.datasource.hikari.minimum-idle=1
# Automatically update the database schema. Recommended for development only.
# NOTE: If you get JDBC column extraction errors (e.g., "Bad value for type long"),
# recreate the Docker PostgreSQL container to reset the schema.
spring.jpa.hibernate.ddl-auto=update

# Jackson configuration - serialize LocalDateTime as ISO string instead of array
spring.jackson.serialization.write-dates-as-timestamps=false

# Multipart configuration
# For files > 100MB, the frontend uses the streaming endpoint which bypasses this limit
spring.servlet.multipart.max-file-size=100MB
spring.servlet.multipart.max-request-size=100MB

# Logging configuration
logging.level.root=INFO
logging.level.com.muczynski=DEBUG
logging.level.org.springframework.web=INFO
logging.level.org.springframework.messaging=INFO
logging.level.org.springframework.web.socket=INFO

# CORS configuration
spring.mvc.cors.allowed-origins=*
spring.mvc.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.mvc.cors.allowed-headers=*
spring.mvc.cors.allow-credentials=true

# Google OAuth configuration (for Google Photos integration)
google.oauth.client-id=
google.oauth.auth-uri=https://accounts.google.com/o/oauth2/auth
google.oauth.token-uri=https://oauth2.googleapis.com/token
google.oauth.scope=https://www.googleapis.com/auth/photoslibrary.edit.appcreateddata https://www.googleapis.com/auth/photoslibrary.readonly.appcreateddata https://www.googleapis.com/auth/photospicker.mediaitems.readonly https://www.googleapis.com/auth/photoslibrary.appendonly https://www.googleapis.com/auth/photoslibrary.sharing

# Google SSO configuration is handled by DynamicClientRegistrationRepository
# which reads credentials from GlobalSettings (database) or environment variables

# PDF Labels font sizes (in points)
app.labels.font-size.title=11
app.labels.font-size.author=10
app.labels.font-size.loc=10

# Spring Session configuration
# Store sessions in database for persistence across server restarts
spring.session.store-type=jdbc
spring.session.jdbc.initialize-schema=never
spring.session.timeout=77d

# SQL initialization - create session tables
spring.sql.init.mode=always
spring.sql.init.schema-locations=classpath:schema-session.sql
